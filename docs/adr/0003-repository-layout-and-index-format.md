---
adr_id: ADR-0003
title: Repository Layout and Index File Format
status: adopted
date: 2026-01-16
scope:
  paths:
    - "docs/adr/**"
    - "internal/index/**"
    - "cmd/decider/**"
tags:
  - structure
  - index
  - schema
constraints:
  - ADRs must live in docs/adr/ by default
  - Index file must be regenerable from ADR files
  - Index schema must remain stable for machine consumers
invariants:
  - Index always reflects current ADR state when regenerated
  - Index keys use snake_case for consistency
  - Generated timestamps are RFC3339 UTC
supersedes: []
superseded_by: []
related_adrs:
  - ADR-0002
---

# ADR-0003: Repository Layout and Index File Format

## Context

DECIDER needs:
1. A consistent directory structure for ADRs
2. An index file format that AI agents can quickly parse
3. Clear separation between source (ADRs) and generated (index) content

Decision drivers:
- AI agents need fast access to ADR metadata without parsing all files
- Index must be versionable in Git for offline agent access
- Schema must be stable so external tools can depend on it
- Layout must work with standard project structures

## Decision

We adopt a **docs/adr/ directory layout** with a **YAML index file**.

### YAML Index in docs/adr/: Adopted

**Adopted because:**
- YAML is human-readable for debugging and inspection
- Comment header clearly marks file as auto-generated
- Single file lookup is faster than scanning all ADRs for agents
- YAML is already used for frontmatter, reducing tooling needs
- Index can be committed to Git for offline agent access
- Schema stability is achievable with semantic versioning

**Adopted despite:**
- Index can become stale if developers forget to regenerate
- Extra file to manage in the repository
- YAML parsing is marginally slower than JSON
- Developers might accidentally edit the generated file

### Repository Layout

```
project-root/
├── docs/
│   └── adr/
│       ├── templates/
│       │   └── adr.md           # ADR template
│       ├── index.yaml           # Generated index (do not edit)
│       ├── 0001-first-adr.md
│       ├── 0002-second-adr.md
│       └── ...
├── cmd/decider/                  # CLI entrypoint
├── internal/                     # Private Go packages
├── .github/workflows/            # CI/CD
└── ...
```

### Index File Format (`index.yaml`)

```yaml
# AUTO-GENERATED by decider index - DO NOT EDIT
generated_at: "2026-01-16T10:30:00Z"  # RFC3339 UTC
adr_count: 42
adrs:
  - adr_id: ADR-0001
    title: "First Decision"
    status: adopted
    date: "2026-01-15"
    tags:
      - foundation
      - tooling
    scope_paths:
      - "src/**"
    file: "0001-first-decision.md"
  - adr_id: ADR-0002
    # ...
```

### Index Schema Stability

The following keys are **stable** and will not change in breaking ways:

| Key | Type | Description |
|-----|------|-------------|
| `generated_at` | string (RFC3339) | When index was generated |
| `adr_count` | integer | Number of ADRs indexed |
| `adrs` | array | List of ADR entries |
| `adrs[].adr_id` | string | ADR identifier |
| `adrs[].title` | string | ADR title |
| `adrs[].status` | string | Status enum value |
| `adrs[].date` | string (YYYY-MM-DD) | Decision date |
| `adrs[].tags` | array of strings | Tags |
| `adrs[].scope_paths` | array of strings | Scope path globs |
| `adrs[].file` | string | Filename relative to ADR directory |

New keys may be added but existing keys will not be removed or renamed without a major version bump.

### Generated File Handling

- `index.yaml` includes a header comment indicating it's auto-generated
- Running `decider index` regenerates the file completely
- The index should be committed to version control for agent access
- CI should run `decider index --check` to verify index is up-to-date

## Alternatives Considered

### JSON Index: Rejected

**Rejected because:**
- JSON does not support comments, so no "DO NOT EDIT" header
- Less human-readable when debugging index issues
- Strict syntax makes manual inspection harder
- Inconsistent with YAML frontmatter used in ADRs

**Rejected despite:**
- Faster parsing than YAML in most languages
- Unambiguous syntax with no parsing edge cases
- Wider language support (though YAML is sufficient)
- Smaller file size for very large indexes

### SQLite Database: Rejected

**Rejected because:**
- Binary format causes merge conflicts in Git
- Requires SQLite tooling to inspect contents
- Overkill for the expected number of ADRs (tens to hundreds)
- AI agents would need SQLite bindings or additional tooling

**Rejected despite:**
- Query flexibility (SQL filters, joins)
- Efficient storage and retrieval for very large datasets
- ACID guarantees for concurrent access
- Single file with embedded data and schema

### No Index (Always Scan ADRs): Rejected

**Rejected because:**
- Slow for large ADR sets (O(n) file reads for every query)
- Requires parsing YAML frontmatter for every list operation
- Repeated file I/O impacts CLI responsiveness
- No single source for agent metadata lookup

**Rejected despite:**
- Simplest implementation with no synchronization issues
- Always accurate (no stale index possible)
- No extra file to manage
- Works correctly even if index regeneration is forgotten

## Consequences

**Positive:**
- Fast ADR lookup via index for agents and CLI
- Human-readable YAML format for debugging
- Clear source of truth (ADRs) vs. derived data (index)
- Stable schema enables external tool integration

**Negative:**
- Index can become stale (mitigated by CI check with `decider index --check`)
- Extra file to manage (mitigated by auto-generation)
- Developers might edit index manually (mitigated by header comment)

## Agent Guidance

When working with the index:
- Never manually edit `index.yaml`
- Run `decider index` after creating/modifying ADRs
- Use `decider list` to query ADRs (uses index if available)
- The index is the fastest way to find ADRs by tag or scope
